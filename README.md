# Описание платежного модуля ИнвойсБокс для CMS MODX (Revo) MiniShop2

Платёжный модуль для интеграции платёжной системы «ИнвойсБокс» и CMS MODX (Revo) версии 2.6.x и выше. Реализована поддержка платёжного API. Протестировано на системе MiniShop v2.4.12.

## Установка модуля

1. Распакуйте архив;
1. Скопируйте из архива каталог assets и core в корень системы MODX.
1. В административной панели Modx пройдите в раздел <strong>"Приложения" -> "Minishop2" -> "Настройки" -> "Способы оплаты" -> "Создать"</strong>;
1. Заполните все поля, в поле Класс-обработчик указать <strong>Invoicebox</strong>.

## Настройка модуля
1. Открыть файл для редактирования 
<strong>core/components/minishop2/custom/payment/invoicebox.class.php</strong>;
1. В верху заполнить поля:
    - INVOICEBOX_API_KEY - Укажите секретный код из личного кабинета Invoicebox; 
    - INVOICEBOX_CURRENCY - Валюта;
    - INVOICEBOX_ID - Идентификатор интернет-магазина в Invoicebox из личного кабинета Invoicebox;
    - INVOICEBOX_IDENT - Региональный код магазина в Invoicebox из личного кабинета Invoicebox;
    - INVOICEBOX_TESTMODE - Тестовый режим Invoicebox (Если 1 - деньги не будут списываться с карты);
    - INVOICEBOX_VAT - Ставка налога;
    - INVOICEBOX_SUCCESS_ID - Id страницы успешной оплаты;
    - INVOICEBOX_CANCEL_ID - Id страницы не успешной оплаты;
1. Сохраните файл.

### Настройка панели ИнвойсБокс:

1. Для настройки панели управления ИнвойсБокс пройдите по url - https://login.invoicebox.ru/ ;
1. Авторизуйтесь и пройдите в раздел "Мои магазины". "Начало работы" -> "Настройки" -> "Мои магазины";
1. Пройдите по вкладку "Уведомления по протоколу" -> выберите "Тип уведомления" "Оплата/HTTP/Post (HTTP POST запрос с данными оплаты в переменных)"
1. В поле "URL уведомления" укажите:

    `<домен_сайта>/assets/components/minishop2/payment/invoicebox.php`

1. Сохраните изменения.
